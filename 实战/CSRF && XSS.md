## @ `CSRF`

`CSRF`(`Cross Site Request Forgery`, 跨站域请求伪造)是一种网络的攻击方式,它在 2007 年曾被列为互联网 20 大安全隐患之一.其他安全隐患,比如 `SQL` 脚本注入,跨站域脚本攻击等在近年来已经逐渐为众人熟知,很多网站也都针对他们进行了防御.然而,对于大多数人来说,`CSRF` 却依然是一个陌生的概念.即便是大名鼎鼎的 `Gmail`, 在 2007 年底也存在着 `CSRF` 漏洞,从而被黑客攻击而使 `Gmail` 的用户造成巨大的损失.


## @ 当前防御 `CSRF` 的几种策略

在业界目前防御 `CSRF` 攻击主要有三种策略：验证 `HTTP Referer` 字段;在请求地址中添加 `token` 并验证;在 `HTTP` 头中自定义属性并验证.下面就分别对这三种策略进行详细介绍.

## @ `CSRF` 防御方法选择之道

通过上文讨论可知,目前业界应对 CSRF 攻击有一些克制方法,但是每种方法都有利弊,没有一种方法是完美的.如何选择合适的方法非常重要.如果网站是一个现有系统,想要在最短时间内获得一定程度的 CSRF 的保护,那么验证 Referer 的方法是最方便的,要想增加安全性的话,可以选择不支持低版本浏览器,毕竟就目前来说,IE7+, FF3+ 这类高版本浏览器的 Referer 值还无法被篡改.

如果是开发一个全新的系统,则抵御 `CSRF` 的选择要大得多.笔者建议对于重要的服务,可以尽量使用 `XMLHttpRequest` 来访问,这样增加 `token` 要容易很多.另外尽量避免在 `js` 代码中使用复杂逻辑来构造常规的同步请求来访问需要 CSRF 保护的资源,比如 `window.location` 和 `document.createElement('a')` 之类,这样也可以减少在附加 token 时产生的不必要的麻烦.

最后,要记住 `CSRF` 不是黑客唯一的攻击手段,无论你 `CSRF` 防范有多么严密,如果你系统有其他安全漏洞,比如跨站域脚本攻击 `XSS`,那么黑客就可以绕过你的安全防护,展开包括 `CSRF` 在内的各种攻击,你的防线将如同虚设.

## @ 总结

可见,`CSRF` 是一种危害非常大的攻击,又很难以防范.目前几种防御策略虽然可以很大程度上抵御 `CSRF` 的攻击,但并没有一种完美的解决方案.一些新的方案正在研究之中,比如对于每次请求都使用不同的动态口令,把 `Referer` 和 `token` 方案结合起来,甚至尝试修改 `HTTP` 规范,但是这些新的方案尚不成熟,要正式投入使用并被业界广为接受还需时日.在这之前,我们只有充分重视 `CSRF`,根据系统的实际情况选择最合适的策略,这样才能把 `CSRF` 的危害降到最低.

## @ 在跨站脚本攻击中会发生什么

跨站脚本攻击(`cross-site scripting`,简称 `XSS`),是黑客用来潜入 `Web` 应用程序的最普遍的应用程序层攻击之一.`XSS` 是针对特殊 `Web` 站点的客户隐私的攻击,当客户详细信息失窃或受控时可能引发彻底的安全威胁.大部分网站攻击只涉及两个群体;黑客和 `Web` 站点,或者黑客和客户端受害者.与那些攻击不同的是,`XSS` 攻击同时涉及三个群体;黑客、客户端和 `Web` 站点.

XSS 攻击的目的是盗走客户端 `cookies`,或者任何可以用于在 `Web` 站点确定客户身份的其他敏感信息.手边有了合法用户的标记,黑客可以继续扮演用户与站点交互,从而冒充用户.举例来说,在对一个大型公司的调查中表明,利用 `XSS` 攻击窥视用户的信用卡号码和私有信息是可能的.这是通过利用 `Web` 站点的访问特权,在受害者(客户端)浏览器上运行恶意的 `JavaScript` 代码来实现的.这些是非常有限的 `JavaScript` 特权,除了与站点相关的信息,一般不允许脚本访问其他任何内容.重点强调的是,虽然 `Web` 站点上存在安全漏洞,但是 `Web` 站点从未受到直接伤害.但是这已经足够让脚本收集 `cookies`,并且将它们发送给黑客.因此,黑客获得 `cookies` 并冒充受害者.

## @ 参考

[IBM Rational AppScan;跨站点脚本攻击深入解析](https://www.ibm.com/developerworks/cn/rational/08/0325_segal/)

[总结 XSS 与 CSRF 两种跨站攻击](https://blog.tonyseek.com/post/introduce-to-xss-and-csrf/)

[CSRF 攻击的应对之道](https://www.ibm.com/developerworks/cn/web/1102_niugang_csrf/)
